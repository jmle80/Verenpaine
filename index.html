<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keto-Opas v2.1 (Iltapalalla)</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 0;
            padding-bottom: 100px;
        }

        /* --- TY√ñKALUT & UI --- */
        .version-tag {
            background-color: #8e44ad; /* Violetti v2.1 */
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
        }

        h1, h2 { margin: 0; margin-bottom: 10px; }
        
        button { cursor: pointer; }

        /* --- LATAUSRUUTU --- */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; color: #2c3e50;
        }

        /* --- P√ÑIV√ÑN√ÑKYM√Ñ --- */
        .view { display: none; padding: 15px; max-width: 600px; margin: 0 auto; }
        .view.active { display: block; }

        .shift-toggle-container { display: flex; margin: 15px 0; }
        .shift-btn {
            flex: 1; padding: 12px; border: 2px solid #2c3e50;
            background: white; color: #2c3e50; font-weight: bold;
        }
        .shift-btn.active { background: #2c3e50; color: white; }

        .day-controls {
            display: flex; justify-content: space-between; align-items: center;
            background: white; padding: 10px; border-radius: 8px; margin-bottom: 20px;
        }
        .ctrl-btn {
            background: #2c3e50; color: white; border: none;
            padding: 10px 20px; border-radius: 5px; font-size: 1.2rem;
        }

        .meal-card {
            background: white; border-radius: 8px; padding: 15px;
            margin-bottom: 15px; border-left: 5px solid #27ae60;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .meal-time { color: #7f8c8d; font-size: 0.9rem; font-weight: bold; display: block; margin-bottom: 5px; }
        .meal-title { font-size: 1.1rem; font-weight: bold; color: #2c3e50; margin-bottom: 10px; }

        details { border-top: 1px solid #eee; margin-top: 10px; padding-top: 10px; }
        summary { font-weight: bold; color: #27ae60; outline: none; }
        .recipe-text { margin-top: 10px; line-height: 1.5; font-size: 0.95rem; }

        /* --- KAUPPALISTA --- */
        .shop-item {
            background: white; padding: 12px; margin-bottom: 5px;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 5px; border: 1px solid #ddd;
        }
        .shop-item.checked span { text-decoration: line-through; color: #999; }
        .shop-item input { transform: scale(1.5); margin-right: 10px; }
        
        .total-box {
            background: #2c3e50; color: white; padding: 15px;
            text-align: center; font-size: 1.2rem; font-weight: bold;
            border-radius: 8px; margin-bottom: 20px;
        }

        .reset-btn {
            width: 100%; padding: 15px; background: #c0392b; color: white;
            border: none; font-weight: bold; font-size: 1rem; border-radius: 5px; margin-top: 20px;
        }

        /* --- NAVIGAATIO --- */
        .nav-tabs {
            position: fixed; bottom: 0; width: 100%; display: flex;
            background: white; border-top: 1px solid #ccc; height: 60px;
        }
        .nav-btn { flex: 1; border: none; background: white; font-weight: bold; color: #7f8c8d; }
        .nav-btn.active { color: #2c3e50; border-top: 4px solid #27ae60; }

        /* --- Y√ñTILA (CSS) --- */
        body.night-mode { background-color: #222; color: #ddd; }
        body.night-mode .meal-card, body.night-mode .shop-item, body.night-mode .day-controls, body.night-mode .nav-tabs { background: #333; color: #fff; }
        body.night-mode .nav-btn { background: #333; }
        body.night-mode .meal-title { color: #f1c40f; }
        body.night-mode summary { color: #f1c40f; }
        body.night-mode .shift-btn { background: #333; color: #f1c40f; border-color: #f1c40f; }
        body.night-mode .shift-btn.active { background: #f1c40f; color: #222; }

    </style>
</head>
<body>

    <div id="loading-screen">Ladataan sovellusta...</div>

    <div class="version-tag">Versio 2.1 - Iltapala lis√§tty</div>
    <header><h1>Keto-Opas 46v</h1></header>

    <div id="view-day" class="view active">
        <div class="shift-toggle-container">
            <button class="shift-btn active" id="btn-morning" onclick="app.setShift('morning')">‚òÄ Aamuvuoro</button>
            <button class="shift-btn" id="btn-night" onclick="app.setShift('night')">üåô Y√∂vuoro</button>
        </div>

        <div class="day-controls">
            <button class="ctrl-btn" onclick="app.changeDay(-1)">&#8592;</button>
            <h2 id="day-title">Maanantai</h2>
            <button class="ctrl-btn" onclick="app.changeDay(1)">&#8594;</button>
        </div>

        <div id="meals-list"></div>
    </div>

    <div id="view-shop" class="view">
        <h2>Ostoslista</h2>
        <div class="total-box">Yhteens√§: <span id="total-price">0.00</span> ‚Ç¨</div>
        <div id="shop-list"></div>
        <button class="reset-btn" onclick="app.resetShop()">Tyhjenn√§ lista</button>
    </div>

    <div class="nav-tabs">
        <button class="nav-btn active" id="nav-day" onclick="app.switchTab('day')">P√§iv√§ohjelma</button>
        <button class="nav-btn" id="nav-shop" onclick="app.switchTab('shop')">Kauppalista</button>
    </div>

<script>
/** * TIETOKANTA (Nyt 4 ateriaa per p√§iv√§)
 * 0: Aamu, 1: Lounas, 2: P√§iv√§llinen, 3: Iltapala
 */
const DATA = {
    week: [
        { day: "Maanantai", meals: [
            { n: "Mustikkasmoothie / Munat", r: "1dl mustikoita, ¬Ω avokado, 1dl kermaa. TAI 2 paistettua munaa." },
            { n: "Tonnikalasalaatti", r: "1 prk tonnikalaa, salaattia, kurkkua, 1 muna, p√§hkin√∂it√§, majoneesia." },
            { n: "Uunilohi & Parsakaali", r: "200g lohta uuniin (200¬∞C 20min). H√∂yrytetty parsakaali voilla." },
            { n: "Turkkilainen Jogurtti", r: "2 dl turkkilaista jogurttia, ripaus marjoja tai p√§hkin√∂it√§." }
        ]},
        { day: "Tiistai", meals: [
            { n: "Smoothie / Munat", r: "Ks. maanantai." },
            { n: "Uunilohen j√§m√§t", r: "Maanantain lohta majoneesilla." },
            { n: "Kanaa & Kukkakaalimuusia", r: "2 paistileikett√§ uuniin (35min). Keit√§ kukkakaali, soseuta voin ja kerman kanssa." },
            { n: "Juustosiivut", r: "3-4 siivua paksua juustoa ja kurkkutikkuja." }
        ]},
        { day: "Keskiviikko", meals: [
            { n: "Smoothie / Munat", r: "Ks. maanantai." },
            { n: "Kanaa & Muusia", r: "Tiistain j√§m√§t." },
            { n: "Jauhelihapihvit", r: "400g jauhelihaa (tee 4 pihvi√§, sy√∂ 2). Paista voissa. Lis√§ksi vihreit√§ papuja." },
            { n: "P√§hkin√§t & Tee", r: "Kourallinen (n. 30g) p√§hkin√∂it√§ ja iso kupillinen teet√§." }
        ]},
        { day: "Torstai", meals: [
            { n: "Smoothie / Munat", r: "Ks. maanantai." },
            { n: "Jauhelihapihvit", r: "2 eilist√§ pihvi√§, salaattia, oliivi√∂ljy√§." },
            { n: "Tonnikalavuoka", r: "Kes√§kurpitsaa, 2 prk tonnikalaa, 2dl kermaa, juustoa. Uuni 200¬∞C 25min." },
            { n: "Smoothien loppu", r: "Pieni mustikkasmoothie (puolikas annos)." }
        ]},
        { day: "Perjantai", meals: [
            { n: "Tuhti munakas", r: "3 munaa, kermaa, juustoa pannulle." },
            { n: "Smoothie / Kevyt", r: "Mustikkasmoothie." },
            { n: "Kermainen Pekoni-Kana", r: "150g kanaa, pekonia. Paista. Lis√§√§ 2dl kermaa. Hauduta. Parsakaalia." },
            { n: "Kermavaahto & Marjat", r: "1 dl kermavaahtoa (makeutusainetta jos haluat) ja mustikoita." }
        ]},
        { day: "Lauantai", meals: [
            { n: "Brunssi", r: "Munakokkelia, pekonia, kahvia." },
            { n: "Kanasalaatti", r: "Perjantain kanan j√§m√§t salaatilla, avokadoa, p√§hkin√∂it√§." },
            { n: "Wingsit", r: "500g siipi√§ uuniin. Dippaa majoneesiin. Kurkkutikkuja." },
            { n: "Leikkelelautanen", r: "Muutama siivu kinkkua/meetvurstia ja juustoa." }
        ]},
        { day: "Sunnuntai", meals: [
            { n: "Smoothie", r: "Mustikkasmoothie." },
            { n: "Wingsien j√§m√§t", r: "Loput siivet." },
            { n: "Keto-Pizza (tai Tankkaus)", r: "Pohja: 2 munaa+3dl juustoa (uuni 10min). T√§yte: pyree, kana, juusto. (Jos Y√∂vuoro: Sy√∂ klo 19)." },
            { n: "Iltapala / Y√∂ev√§s", r: "Turkkilainen jogurtti p√§hkin√∂ill√§." }
        ]}
    ],
    shop: [
        { c: "HeVi", i: [
            { n: "J√§√§salaatti", p: 1.49 }, { n: "Kurkku (2)", p: 1.80 }, { n: "Tomaatti", p: 2.49 },
            { n: "Parsakaali 400g", p: 1.19 }, { n: "Kukkakaali", p: 2.99 }, { n: "Avokadoja", p: 2.95 },
            { n: "Kes√§kurpitsa", p: 1.20 }, { n: "Sipuli", p: 1.50 }, { n: "Vihr. Pavut", p: 0.95 }
        ]},
        { c: "Liha/Kala", i: [
            { n: "Jauheliha 400g", p: 3.99 }, { n: "Broileri paistileike", p: 4.50 },
            { n: "Broileri suikale", p: 4.29 }, { n: "Siivet 1kg", p: 3.99 },
            { n: "Kirjolohi 600g", p: 9.90 }, { n: "Pekoni", p: 1.39 }
        ]},
        { c: "Maito/Munat", i: [
            { n: "Munat 15kpl", p: 2.59 }, { n: "Kuohukerma 1L", p: 4.19 },
            { n: "Voi 500g", p: 3.49 }, { n: "Juustoraaste 500g", p: 3.95 },
            { n: "Turkkilainen Jogurtti", p: 2.65 }
        ]},
        { c: "Muut", i: [
            { n: "Tonnikala (4prk)", p: 5.95 }, { n: "P√§hkin√§t", p: 3.49 },
            { n: "Tomaattipyree", p: 0.60 }, { n: "Majoneesi", p: 2.15 }, { n: "Oliivi√∂ljy", p: 4.50 }
        ]}
    ]
};

/**
 * SOVELLUSLOGIIKKA (Namespace 'app')
 */
const app = {
    state: {
        dayIdx: 0,
        shift: 'morning', // 'morning' | 'night'
        checked: []
    },

    init: function() {
        // 1. Lataa tallennus
        try {
            const s = localStorage.getItem('ketoState_v2');
            if (s) this.state = JSON.parse(s);
        } catch(e) { console.log("Ei tallennustukea"); }

        // 2. Piilota latausruutu
        document.getElementById('loading-screen').style.display = 'none';

        // 3. Render√∂i
        this.renderDay();
        this.renderShop();
        this.updateUI();
    },

    save: function() {
        try {
            localStorage.setItem('ketoState_v2', JSON.stringify(this.state));
        } catch(e) {}
    },

    /* --- TOIMINNOT --- */

    changeDay: function(dir) {
        this.state.dayIdx += dir;
        if (this.state.dayIdx < 0) this.state.dayIdx = 6;
        if (this.state.dayIdx > 6) this.state.dayIdx = 0;
        this.save();
        this.renderDay();
    },

    setShift: function(mode) {
        this.state.shift = mode;
        this.save();
        this.updateUI(); // Vaihtaa teeman
        this.renderDay();
    },

    switchTab: function(tab) {
        document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
        document.getElementById('view-' + tab).classList.add('active');
        
        document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
        document.getElementById('nav-' + tab).classList.add('active');
    },

    toggleShopItem: function(name) {
        const idx = this.state.checked.indexOf(name);
        if (idx > -1) this.state.checked.splice(idx, 1);
        else this.state.checked.push(name);
        this.save();
        this.renderShop();
    },

    resetShop: function() {
        if(confirm("Tyhjennet√§√§nk√∂ lista?")) {
            this.state.checked = [];
            this.save();
            this.renderShop();
        }
    },

    /* --- RENDER√ñINTI --- */

    updateUI: function() {
        // P√§ivit√§ napit
        const isNight = (this.state.shift === 'night');
        document.body.className = isNight ? 'night-mode' : '';
        document.getElementById('btn-morning').className = isNight ? 'shift-btn' : 'shift-btn active';
        document.getElementById('btn-night').className = isNight ? 'shift-btn active' : 'shift-btn';
    },

    renderDay: function() {
        const d = DATA.week[this.state.dayIdx];
        document.getElementById('day-title').innerText = d.day;
        
        const list = document.getElementById('meals-list');
        list.innerHTML = '';

        // Oletusj√§rjestys (Aamuvuoro / Vapaa)
        // 0: Aamu, 1: Lounas, 2: P√§iv√§llinen, 3: Iltapala
        let order = [0, 1, 2, 3]; 
        let labels = ["Aamupala (07:00)", "Lounas (11:00)", "P√§iv√§llinen (16:30)", "Iltapala (20:30)"];

        const isWeekend = (this.state.dayIdx === 5 || this.state.dayIdx === 6);

        // Y√∂vuoro-logiikka (Arkip√§iv√§t)
        // K√§√§nnet√§√§n rytmi: Her√§√§minen (n. 15), T√∂ihin (n. 19), T√∂iss√§ (01), Aamulla (07)
        if (this.state.shift === 'night' && !isWeekend) {
            order = [0, 2, 1, 3]; 
            // 0 (Aamu-tyylinen ruoka) -> Sy√∂d√§√§n iltap√§iv√§ll√§ her√§tess√§
            // 2 (P√§iv√§llinen/Tuhti) -> Sy√∂d√§√§n ennen t√∂it√§ tankkauksena
            // 1 (Lounas/Ev√§s) -> Sy√∂d√§√§n t√∂iss√§ y√∂ll√§
            // 3 (Iltapala/Kevyt) -> Sy√∂d√§√§n aamulla t√∂iden j√§lkeen ennen unta
            labels = ["Her√§√§minen (15:00)", "Tankkaus (19:00)", "Y√∂ev√§s (01:00)", "Aamupala/Uni (07:00)"];
        }
        
        // Sunnuntai-ilta logiikka (Valmistautuminen y√∂h√∂n)
        if (this.state.dayIdx === 6 && this.state.shift === 'night') {
             // Sunnuntaina sy√∂d√§√§n aamu/lounas normaalisti, mutta ilta tankataan
             labels = ["Vapaa Aamu", "Lounas", "TANKKAUS Y√ñH√ñN (19:00)", "Y√∂ev√§s (T√∂ihin)"];
        }

        order.forEach((mealIdx, i) => {
            const m = d.meals[mealIdx];
            if (!m) return; // Varotoimi
            
            const div = document.createElement('div');
            div.className = 'meal-card';
            div.innerHTML = `
                <span class="meal-time">${labels[i]}</span>
                <div class="meal-title">${m.n}</div>
                <details>
                    <summary>Ohje</summary>
                    <div class="recipe-text">${m.r}</div>
                </details>
            `;
            list.appendChild(div);
        });
    },

    renderShop: function() {
        const list = document.getElementById('shop-list');
        list.innerHTML = '';
        let total = 0;

        DATA.shop.forEach(cat => {
            const h3 = document.createElement('h3');
            h3.innerText = cat.c;
            h3.style.marginTop = "15px";
            list.appendChild(h3);

            cat.i.forEach(item => {
                total += item.p;
                const isChecked = this.state.checked
