<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keto-Opas v5.0</title>
    <style>
        /* PERUSTYYLIT */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 0;
            padding-bottom: 90px; /* Tilaa alanaville */
        }

        /* VERSIO (Ohje: 1. rivi, eri v√§ri) */
        .version-tag {
            background-color: #e67e22; /* Oranssi v5.0 */
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* LATAUSRUUTU & VIRHEET */
        #status-display {
            padding: 20px;
            text-align: center;
            font-size: 1.2rem;
            color: #555;
            background: #fff;
            margin: 20px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }
        .error-msg { color: red; font-weight: bold; }

        /* HEADER */
        header { background: #2c3e50; color: white; padding: 15px; text-align: center; }
        h1 { margin: 0; font-size: 1.5rem; }
        h2 { margin-top: 0; color: #2c3e50; }

        /* N√ÑKYM√ÑT */
        .view { display: none; padding: 15px; max-width: 600px; margin: 0 auto; }
        .view.active { display: block; }

        /* VUOROKYTKIN */
        .shift-toggle-container { display: flex; margin: 15px 0; }
        .shift-btn {
            flex: 1; padding: 12px;
            border: 2px solid #2c3e50;
            background: white; color: #2c3e50;
            font-weight: bold; cursor: pointer;
        }
        .shift-btn.active { background: #2c3e50; color: white; }

        /* P√ÑIV√ÑNAVIGAATIO */
        .day-controls {
            display: flex; justify-content: space-between; align-items: center;
            background: white; padding: 10px; border-radius: 8px;
            margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .ctrl-btn {
            background: #2c3e50; color: white; border: none;
            padding: 10px 20px; border-radius: 5px; font-size: 1.2rem;
        }

        /* ATERIAKORTTI */
        .meal-card {
            background: white; border-radius: 8px; padding: 15px;
            margin-bottom: 15px; border-left: 5px solid #27ae60;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .meal-time { font-size: 0.85rem; color: #7f8c8d; font-weight: bold; display: block; margin-bottom: 5px; text-transform: uppercase; }
        .meal-title { font-size: 1.1rem; font-weight: bold; color: #2c3e50; margin-bottom: 5px; }
        
        details { border-top: 1px solid #eee; margin-top: 10px; padding-top: 10px; }
        summary { color: #27ae60; font-weight: bold; cursor: pointer; outline: none; }
        .recipe-text { margin-top: 10px; line-height: 1.5; font-size: 0.95rem; }

        /* KAUPPALISTA */
        .shop-category { margin-top: 20px; }
        .shop-cat-title { font-weight: bold; border-bottom: 2px solid #ddd; margin-bottom: 10px; color: #2c3e50; }
        
        .shop-item {
            background: white; padding: 10px; margin-bottom: 6px;
            border-radius: 5px; border: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
        }
        .shop-item.checked span { text-decoration: line-through; color: #aaa; }
        
        /* S-Haku Nappi */
        .s-link {
            text-decoration: none; background: #009d4a; color: white;
            padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold;
            margin-left: 10px;
        }

        .total-box {
            background: #2c3e50; color: white; padding: 15px;
            text-align: center; font-size: 1.2rem; font-weight: bold;
            border-radius: 8px; margin-bottom: 20px;
        }

        .reset-btn {
            width: 100%; padding: 15px; background: #c0392b; color: white;
            border: none; font-weight: bold; font-size: 1rem;
            border-radius: 5px; margin-top: 20px; cursor: pointer;
        }

        /* ALANAVIGAATIO */
        .nav-tabs {
            position: fixed; bottom: 0; width: 100%; height: 60px;
            display: flex; background: white; border-top: 1px solid #ccc; z-index: 100;
        }
        .nav-btn {
            flex: 1; border: none; background: white;
            font-weight: bold; color: #7f8c8d; cursor: pointer;
        }
        .nav-btn.active { color: #2c3e50; border-top: 4px solid #27ae60; }

        /* Y√ñTILA CSS */
        body.night-mode { background: #222; color: #ddd; }
        body.night-mode .meal-card, body.night-mode .shop-item, body.night-mode .day-controls { background: #333; border-color: #444; }
        body.night-mode .meal-title, body.night-mode .shop-cat-title { color: #f1c40f; }
        body.night-mode .nav-tabs, body.night-mode .nav-btn { background: #333; }
        body.night-mode .shift-btn { background: #333; color: #f1c40f; border-color: #f1c40f; }
        body.night-mode .shift-btn.active { background: #f1c40f; color: #222; }

    </style>
</head>
<body>

    <div class="version-tag">Versio 5.0 - Final Checklisted</div>
    
    <div id="status-display">Ladataan sovellusta...<br><small>(Jos t√§m√§ ei katoa, selaimessa on estoja.)</small></div>

    <header>
        <h1>Keto-Opas 46v</h1>
    </header>

    <div id="view-day" class="view">
        <div class="shift-toggle-container">
            <button class="shift-btn active" id="btn-morning" onclick="APP.setShift('morning')">‚òÄ Aamuvuoro</button>
            <button class="shift-btn" id="btn-night" onclick="APP.setShift('night')">üåô Y√∂vuoro</button>
        </div>

        <div class="day-controls">
            <button class="ctrl-btn" onclick="APP.changeDay(-1)">&#8592;</button>
            <h2 id="day-title">Maanantai</h2>
            <button class="ctrl-btn" onclick="APP.changeDay(1)">&#8594;</button>
        </div>

        <div id="meals-container"></div>
    </div>

    <div id="view-shop" class="view">
        <h2>Ostoslista</h2>
        <div class="total-box">Yhteens√§: <span id="total-price">0.00</span> ‚Ç¨</div>
        <div style="text-align:center; font-size:0.85rem; color:#666; margin-bottom:10px;">
            Paina <b>S-Haku</b> avataksesi tuotteen S-kaupat.fi:ss√§.
        </div>
        <div id="shop-container"></div>
        <button class="reset-btn" onclick="APP.resetList()">Tyhjenn√§ lista</button>
    </div>

    <div class="nav-tabs">
        <button class="nav-btn active" id="nav-day" onclick="APP.switchView('day')">P√§iv√§ohjelma</button>
        <button class="nav-btn" id="nav-shop" onclick="APP.switchView('shop')">Kauppalista</button>
    </div>

<script>
// --- VIKASIETOISUUS ---
window.onerror = function(msg, source, lineno) {
    const el = document.getElementById('status-display');
    el.innerHTML = "<span class='error-msg'>J√§rjestelm√§virhe: " + msg + " (Rivi " + lineno + ")</span>";
    el.style.display = 'block';
};

// --- TIETOKANTA (DATA) ---
const DB = {
    days: [
        "Maanantai", "Tiistai", "Keskiviikko", "Torstai", "Perjantai", "Lauantai", "Sunnuntai"
    ],
    // 0=Aamu, 1=Lounas, 2=P√§iv√§llinen, 3=Iltapala
    menus: [
        // MAANANTAI
        [
            { n: "Mustikkasmoothie / Munat", d: "1dl mustikoita, ¬Ω avokado, 1dl kermaa. TAI 2 paistettua munaa & 10g voita." },
            { n: "Tonnikalasalaatti", d: "1 prk tonnikalaa, salaattia, kurkkua, 1 muna, p√§hkin√∂it√§, majoneesia." },
            { n: "Uunilohi & Parsakaali", d: "200g lohta uuniin (200¬∞C 20min). H√∂yrytetty parsakaali voilla." },
            { n: "Turkkilainen Jogurtti", d: "2 dl turkkilaista jogurttia, ripaus marjoja tai p√§hkin√∂it√§." }
        ],
        // TIISTAI
        [
            { n: "Smoothie / Munat", d: "Katso maanantain ohje." },
            { n: "Uunilohen j√§m√§t", d: "Maanantain lohta majoneesilla." },
            { n: "Kanaa & Kukkakaalimuusia", d: "2 paistileikett√§ uuniin (35min). Keit√§ kukkakaali, soseuta voin ja kerman kanssa." },
            { n: "Juustosiivut", d: "3-4 siivua paksua juustoa ja kurkkutikkuja." }
        ],
        // KESKIVIIKKO
        [
            { n: "Smoothie / Munat", d: "Katso maanantain ohje." },
            { n: "Kanaa & Muusia", d: "Tiistain j√§m√§t l√§mmitettyn√§." },
            { n: "Jauhelihapihvit", d: "400g jauhelihaa (tee 4 pihvi√§, sy√∂ 2). Paista voissa. Lis√§ksi vihreit√§ papuja." },
            { n: "P√§hkin√§t & Tee", d: "Kourallinen (n. 30g) p√§hkin√∂it√§ ja iso kupillinen teet√§." }
        ],
        // TORSTAI
        [
            { n: "Smoothie / Munat", d: "Katso maanantain ohje." },
            { n: "Jauhelihapihvit", d: "2 eilist√§ pihvi√§, salaattia, oliivi√∂ljy√§." },
            { n: "Tonnikalavuoka", d: "Kes√§kurpitsaa, 2 prk tonnikalaa, 2dl kermaa, juustoa. Uuni 200¬∞C 25min." },
            { n: "Smoothien loppu", d: "Pieni mustikkasmoothie (puolikas annos)." }
        ],
        // PERJANTAI
        [
            { n: "Tuhti munakas", d: "3 munaa, kermaa, juustoa pannulle." },
            { n: "Smoothie / Kevyt", d: "Mustikkasmoothie." },
            { n: "Kermainen Pekoni-Kana", d: "150g kanaa, pekonia. Paista. Lis√§√§ 2dl kermaa. Hauduta. Parsakaalia." },
            { n: "Kermavaahto & Marjat", d: "1 dl kermavaahtoa (makeutusainetta jos haluat) ja mustikoita." }
        ],
        // LAUANTAI
        [
            { n: "Brunssi", d: "Munakokkelia, pekonia, kahvia." },
            { n: "Kanasalaatti", d: "Perjantain kanan j√§m√§t salaatilla, avokadoa, p√§hkin√∂it√§." },
            { n: "Wingsit", d: "500g siipi√§ uuniin. Dippaa majoneesiin. Kurkkutikkuja." },
            { n: "Leikkelelautanen", d: "Muutama siivu kinkkua/meetvurstia ja juustoa." }
        ],
        // SUNNUNTAI
        [
            { n: "Smoothie", d: "Mustikkasmoothie." },
            { n: "Wingsien j√§m√§t", d: "Loput siivet." },
            { n: "Keto-Pizza (tai Tankkaus)", d: "Pohja: 2 munaa+3dl juustoa (uuni 10min). T√§yte: pyree, kana, juusto. (Jos Y√∂vuoro: Sy√∂ klo 19)." },
            { n: "Iltapala / Y√∂ev√§s", d: "Turkkilainen jogurtti p√§hkin√∂ill√§." }
        ]
    ],
    // KAUPPALISTA
    // s = hakusana s-kauppaan
    shop: [
        {
            cat: "HeVi", items: [
                { n: "J√§√§salaatti", p: 1.49, s: "kotimaista j√§√§salaatti" },
                { n: "Kurkku (2 kpl)", p: 1.80, s: "kotimaista kurkku" },
                { n: "Tomaatti", p: 2.49, s: "kotimaista tomaatti" },
                { n: "Parsakaali", p: 1.19, s: "parsakaali pakaste" },
                { n: "Kukkakaali", p: 2.99, s: "kukkakaali" },
                { n: "Avokado", p: 2.95, s: "avokado" },
                { n: "Kes√§kurpitsa", p: 1.20, s: "kes√§kurpitsa" },
                { n: "Sipuli", p: 1.50, s: "sipuli" },
                { n: "Vihr. Pavut", p: 0.95, s: "rainbow vihre√§t pavut" }
            ]
        },
        {
            cat: "Liha & Kala", items: [
                { n: "Naudan Jauheliha 400g", p: 3.99, s: "kotimaista naudan jauheliha 17" },
                { n: "Broileri paistileike", p: 4.50, s: "kotimaista broileri paistileike" },
                { n: "Broileri fileesuikale", p: 4.29, s: "kotimaista broileri fileesuikale" },
                { n: "Broileri siivet 1kg", p: 3.99, s: "kotimaista broileri siivet" },
                { n: "Kirjolohi 600g", p: 9.90, s: "kotimaista kirjolohifilee" },
                { n: "Pekoni", p: 1.39, s: "rainbow pekoni" }
            ]
        },
        {
            cat: "Maito & Munat", items: [
                { n: "Munat 15kpl", p: 2.59, s: "kotimaista kananmuna s15" },
                { n: "Kuohukerma 1L", p: 4.19, s: "kotimaista kuohukerma" },
                { n: "Voi 500g", p: 3.49, s: "kotimaista voi" },
                { n: "Juustoraaste 500g", p: 3.95, s: "xtra juustoraaste" },
                { n: "Turkkilainen Jogurtti", p: 2.65, s: "rainbow turkkilainen jogurtti" }
            ]
        },
        {
            cat: "Kuivatuotteet", items: [
                { n: "Tonnikala (4 prk)", p: 5.95, s: "rainbow tonnikala √∂ljyss√§" },
                { n: "P√§hkin√§t", p: 3.49, s: "rainbow saksanp√§hkin√§" },
                { n: "Tomaattipyree", p: 0.60, s: "rainbow tomaattipyree" },
                { n: "Majoneesi", p: 2.15, s: "rainbow majoneesi" },
                { n: "Oliivi√∂ljy", p: 4.50, s: "rainbow oliivi√∂ljy" }
            ]
        }
    ]
};

// --- SOVELLUSLOGIIKKA (APP) ---
const APP = {
    data: {
        day: 0,
        shift: 'morning',
        checked: []
    },

    init: function() {
        // Piilota latausteksti, n√§yt√§ sovellus
        document.getElementById('status-display').style.display = 'none';
        document.getElementById('view-day').style.display = 'block';

        // Lataa muisti
        try {
            const saved = localStorage.getItem('keto_v5_data');
            if (saved) this.data = JSON.parse(saved);
        } catch (e) { console.error("Ei muistia"); }

        this.renderAll();
    },

    save: function() {
        try { localStorage.setItem('keto_v5_data', JSON.stringify(this.data)); } catch (e) {}
    },

    switchView: function(viewId) {
        document.querySelectorAll('.view').forEach(el => el.style.display = 'none');
        document.getElementById('view-' + viewId).style.display = 'block';
        
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('nav-' + viewId).classList.add('active');
    },

    changeDay: function(delta) {
        this.data.day += delta;
        if (this.data.day < 0) this.data.day = 6;
        if (this.data.day > 6) this.data.day = 0;
        this.save();
        this.renderDay();
    },

    setShift: function(mode) {
        this.data.shift = mode;
        this.save();
        this.renderDay();
    },

    toggleCheck: function(itemName) {
        const idx = this.data.checked.indexOf(itemName);
        if (idx > -1) this.data.checked.splice(idx, 1);
        else this.data.checked.push(itemName);
        this.save();
        this.renderShop();
    },

    resetList: function() {
        if(confirm("Haluatko varmasti nollata koko listan?")) {
            this.data.checked = [];
            this.save();
            this.renderShop();
        }
    },

    renderAll: function() {
        this.renderDay();
        this.renderShop();
    },

    renderDay: function() {
        // UI p√§ivitys (teema)
        const isNight = (this.data.shift === 'night');
        document.body.className = isNight ? 'night-mode' : '';
        document.getElementById('btn-morning').className = isNight ? 'shift-btn' : 'shift-btn active';
        document.getElementById('btn-night').className = isNight ? 'shift-btn active' : 'shift-btn';
        
        // Otsikko
        const dayIndex = this.data.day;
        document.getElementById('day-title').innerText = DB.days[dayIndex];

        // Ateriat
        const container = document.getElementById('meals-container');
        container.innerHTML = '';

        // Oletusj√§rjestys: Aamu(0), Lounas(1), P√§iv√§llinen(2), Iltapala(3)
        let order = [0, 1, 2, 3];
        let labels = ["Aamupala (07:00)", "Lounas (11:00)", "P√§iv√§llinen (16:30)", "Iltapala (20:30)"];
        
        const isWeekend = (dayIndex === 5 || dayIndex === 6);

        // Y√∂vuoro (Arkip√§iv√§t)
        if (isNight && !isWeekend) {
            // Her√§√§minen(Aamu-tyyppinen), Tankkaus(P√§iv√§llinen), Y√∂ev√§s(Lounas), Uni(Iltapala)
            order = [0, 2, 1, 3];
            labels = ["Her√§√§minen (15:00)", "Tankkaus (19:00)", "Y√∂ev√§s (01:00)", "Aamupala/Uni (07:00)"];
        }

        // Sunnuntai-illan tankkaus y√∂vuoroon
        if (dayIndex === 6 && isNight) {
             labels = ["Vapaa Aamu", "Lounas", "TANKKAUS Y√ñH√ñN (19:00)", "Y√∂ev√§s (T√∂ihin)"];
        }

        const todayMeals = DB.menus[dayIndex];
        
        order.forEach((mealIdx, i) => {
            const meal = todayMeals[mealIdx];
            if (!meal) return;

            const div = document.createElement('div');
            div.className = 'meal-card';
            div.innerHTML = `
                <span class="meal-time">${labels[i]}</span>
                <div class="meal-title">${meal.n}</div>
                <details>
                    <summary>Valmistusohje</summary>
                    <div class="recipe-text">${meal.d}</div>
                </details>
            `;
            container.appendChild(div);
        });
    },

    renderShop: function() {
        const container = document.getElementById('shop-container');
        container.innerHTML = '';
        let total = 0;

        DB.shop.forEach(cat => {
            const catDiv = document.createElement('div');
            catDiv.className = 'shop-category';
            catDiv.innerHTML = `<div class="shop-cat-title">${cat.cat}</div>`;
            
            cat.items.forEach(item => {
                total += item.p;
                const isChecked = this.data.checked.includes(item.n);
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item' + (isChecked ? ' checked' : '');
                
                // Haku-linkki
                const searchUrl = "https://www.s-kaupat.fi/hakutulokset?queryString=" + encodeURIComponent(item.s);

                itemDiv.innerHTML = `
                    <div style="flex:1" onclick="APP.toggleCheck('${item.n}')">
                        <span style="font-size:1.2rem; margin-right:10px;">${isChecked ? '‚òë' : '‚òê'}</span>
                        <span>${item.n}</span>
                    </div>
                    <div style="text-align:right">
                        <div style="font-weight:bold; font-size:0.9rem;">${item.p.toFixed(2)}‚Ç¨</div>
                        <a href="${searchUrl}" target="_blank" class="s-link">S-Haku</a>
                    </div>
                `;
                catDiv.appendChild(itemDiv);
            });
            container.appendChild(catDiv);
        });
        
        document.getElementById('total-price').innerText = total.toFixed(2);
    }
};

// K√ÑYNNISTYS
window.onload = function() {
    APP.init();
};
</script>

</body>
</html>
